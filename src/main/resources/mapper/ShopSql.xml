<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="data.mapper.ShopMapper">
    <select id="getTotalCount" resultType="int">-- 총글개수
    SELECT count(*) FROM sp
    </select>
    <insert id="insertShop" parameterType="ShopDto">-- 판매글추가
        INSERT INTO sp (ur_num,pd_num,sp_title,sp_txt,sp_wdate,sp_rdcnt)
        VALUES (#{ur_num},#{pd_num},#{sp_title},#{sp_txt},now(),0)
        <selectKey keyProperty="sp_num" resultType="int" order="AFTER">
            SELECT LAST_INSERT_ID()
        </selectKey>
    </insert>
    <select id="getPagingList" parameterType="Map" resultType="ShopProductDto">-- 목록출력
        SELECT * FROM pd,sp WHERE sp.pd_num=pd.pd_num ORDER BY sp_num DESC limit #{startnum}, #{perpage}
        <if test="search_col!=null and search_word!=null">
            where ${search_col} like concat('%',#{search_word},'%')
        </if>
    </select>
    <select id="getData" parameterType="int" resultType="ShopProductDto">-- 상세보기
    SELECT ur_id,prf_nick,prf_img,pd.pd_num,prf_tmp,pd_price,pd_ctg,pd_status,sp_title,sp_txt,sp_wdate,sp_rdcnt
    FROM ur,ur_prf,pd,sp
    WHERE ur.ur_num=ur_prf.ur_num AND sp.ur_num=ur.ur_num AND sp.pd_num=pd.pd_num AND sp.sp_num=#{sp_num}
    </select>
    <update id="updateShop" parameterType="ShopDto">-- 상품수정
    UPDATE sp SET sp_title=#{sp_title},sp_txt=#{sp_txt}
    WHERE sp_num=#{sp_num}
    </update>

    <update id="updateReadCount" parameterType="int">-- 조회수증가
    UPDATE sp SET sp_rdcnt=sp_rdcnt+1 WHERE sp_num=#{sp_num}
    </update>
</mapper>